<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Juego 3 - Aventura Épica</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div id="container">
    <div id="gameWrapper">
      <canvas id="game"></canvas>
    </div>
  </div>
  
  <div id="winModal" class="hidden">
    <div class="modal-content">
      <h1>¡Buen trabajo wey! 🌮🎉</h1>
      <h3>Estos tacos están padre.</h3>
      <div class="modal-actions">
        <button class="modal-btn" id="winBackBtn">Volver al menú</button>
        <button class="modal-btn" id="winRestartBtn">Jugar de nuevo</button>
      </div>
    </div>
  </div>

  <div id="gameOverModal" class="hidden">
    <div class="modal-content">
      <h1>¡Se te fue la mano wey! Ese taco sabía a chingada 😵</h1>
      <h3>Debes recoger: Tortilla → Carnitas → Queso</h3>
      <div class="modal-actions">
        <button class="modal-btn" id="overBackBtn">Volver al menú</button>
        <button class="modal-btn" id="overRestartBtn">Reintentar</button>
      </div>
    </div>
  </div>

  <div id="startModal">
    <div class="modal-content">
      <h1>Big Osito necesita ayuda 🐻🌮 ¡LOS TACOS SE HAN VUELTO LOCOS HERMANO!</h1>
      <h2>
        Tienes que recoger los ingredientes en el orden correcto para formar TRES tacos. 
        El orden es: Tortillas -> Carnitas -> Queso. Evita las cosas sanas y no te olvides de invertir a Bitcoin.
      </h2>
      <div class="modal-actions">
        <button class="modal-btn" id="startBtn">Comenzar</button>
      </div>
    </div>
  </div>

  <script src="gameStorage.js"></script>
  <script src="sidePanel.js"></script>
  <script src="juego3.js"></script>
  <script>
    // ===== Panel Lateral para Juego 3 =====
    let gameStats = {
      score: 0,
      level: 1,
      status: '🔄 En Progreso'
    };

    let gameOptions = {
      immortal: false,
      sound: true,
      difficulty: 'normal',
      xokas: false
    };

    function initSidePanel() {
      if (window.SidePanel) {
        window.SidePanel.createSidePanel({
          gameName: 'Lluvia de tacos',
          gameId: 'juego3',
          stats: gameStats,
          options: gameOptions,
          optionsTemplate: `
            <div class="panel-section">
              <h4>⚙️ Opciones</h4>
              <div class="option-item">
                <span class="option-label">Modo xokas</span>
                <div class="toggle ${gameOptions.xokas ? 'active' : ''}" id="xokasToggle"></div>
              </div>
            </div>
          `,
          initOptions: (panel, onOptionChange) => {
            const xokasToggle = panel.querySelector('#xokasToggle');
            if (xokasToggle) {
              xokasToggle.addEventListener('click', function() {
                this.classList.toggle('active');
                const isActive = this.classList.contains('active');
                onOptionChange({ xokas: isActive });
              });
            }
          },
          onBack: () => window.location.href = 'index.html',
          onRestart: () => {
            if (typeof resetGame === 'function') {
              resetGame();
            }
          },
          onOptionChange: (newOptions) => {
            gameOptions = { ...gameOptions, ...newOptions };
            if (window.GameStorage) {
              window.GameStorage.updateGameOptions(gameOptions);
            }
            if (typeof setXokasMode === 'function' && newOptions.xokas !== undefined) {
              setXokasMode(newOptions.xokas);
            }
          }
        });
      }
    }

    document.addEventListener('DOMContentLoaded', initSidePanel);
  </script>
</body>
</html>
