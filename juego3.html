<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Juego 3 - Aventura Épica</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div id="container">
    <div id="gameWrapper" class="game-small">
      <div id="hud">
        <div id="backBtn">← Volver al Menú</div>
      </div>
      <div id="gameContent">
        <h2>🎯 Juego 3 - Aventura Épica</h2>
        <div id="gameStats">
          <div id="clickCount">Clicks: 0</div>
          <div id="targetClicks">Objetivo: 50 clicks</div>
        </div>
        <div id="clickArea">
          <button id="clickButton">¡Haz Click Aquí!</button>
        </div>
        <div id="gameMessage">¡Haz 50 clicks para completar la aventura!</div>
      </div>
    </div>
  </div>
  
  <div id="overlay" class="hidden">
    <p>🎮 Los juegos requieren una resolución mínima de 1920x1000</p>
    <p>📏 Resolución actual: <span id="currentResolution"></span></p>
    <p>💡 Aumenta el tamaño de la ventana o activa pantalla completa.</p>
  </div>

  <script src="gameStorage.js"></script>
  <script src="resolution.js"></script>
  <script src="sidePanel.js"></script>
  <script>
    // ===== Elementos principales del DOM =====
    const backBtn = document.getElementById('backBtn');
    const overlay = document.getElementById('overlay');
    const clickButton = document.getElementById('clickButton');
    const clickCount = document.getElementById('clickCount');
    const gameMessage = document.getElementById('gameMessage');

    // ===== Estado del juego =====
    let clicks = 0;
    const targetClicks = 50;
    let gameCompleted = false;

    // ===== Lógica del juego =====
    function handleClick() {
      if (gameCompleted) return;
      
      clicks++;
      clickCount.textContent = `Clicks: ${clicks}`;
      
      // Efecto visual del botón
      clickButton.style.transform = 'scale(0.95)';
      setTimeout(() => {
        clickButton.style.transform = 'scale(1)';
      }, 100);
      
      if (clicks >= targetClicks) {
        completeGame();
      } else {
        gameMessage.textContent = `¡Sigue así! Te faltan ${targetClicks - clicks} clicks`;
      }
    }

    function completeGame() {
      gameCompleted = true;
      clickButton.textContent = '¡Completado!';
      clickButton.style.background = 'linear-gradient(45deg, #4CAF50, #45a049)';
      gameMessage.textContent = '¡Felicidades! Has completado la aventura épica!';
      gameMessage.classList.add('completed');
      
      // Guardar progreso en localStorage
      if (window.GameStorage) {
        window.GameStorage.onJuego3Complete();
        console.log('Juego 3 completado: Aventura Épica');
      }
    }

    // ===== Event listeners =====
    backBtn.addEventListener('click', () => {
      window.location.href = 'index.html';
    });

    clickButton.addEventListener('click', handleClick);

    // ===== Verificar resolución =====
    // El sistema de verificación de resolución se maneja automáticamente
    // a través de gameStorage.js con resolución mínima de 1920x1080

    // ===== Panel Lateral para Juego 3 =====
    let gameStats = {
      score: 0,
      level: 1,
      status: '🔄 En Progreso'
    };

    let gameOptions = {
      immortal: false,
      sound: true,
      difficulty: 'normal'
    };

    // Crear panel lateral
    function initSidePanel() {
      if (window.SidePanel) {
        window.SidePanel.createSidePanel({
          gameName: 'Aventura Épica',
          gameId: 'juego3',
          stats: gameStats,
          options: gameOptions,
          onBack: () => window.location.href = 'index.html',
          onRestart: () => {
            clicks = 0;
            gameCompleted = false;
            clickCount.textContent = `Clicks: ${clicks}`;
            clickButton.textContent = '¡Haz Click Aquí!';
            clickButton.style.background = 'linear-gradient(45deg, #ff6b6b, #4ecdc4)';
            gameMessage.textContent = '¡Haz 50 clicks para completar la aventura!';
            gameMessage.classList.remove('completed');
            updatePanelStats();
          },
          onOptionChange: (newOptions) => {
            gameOptions = { ...gameOptions, ...newOptions };
            if (window.GameStorage) {
              window.GameStorage.updateGameOptions(gameOptions);
            }
          }
        });
      }
    }

    // Actualizar estadísticas del panel
    function updatePanelStats() {
      if (window.SidePanel) {
        gameStats.score = clicks * 2; // 2 puntos por click
        gameStats.level = Math.floor(clicks / 10) + 1;
        gameStats.status = gameCompleted ? '✅ Completado' : '🔄 En Progreso';
        window.SidePanel.updateSidePanelStats(gameStats);
      }
    }

    // Inicializar panel cuando se carga la página
    document.addEventListener('DOMContentLoaded', initSidePanel);

    // Actualizar estadísticas cuando cambie el juego
    const originalHandleClick = handleClick;
    handleClick = function() {
      originalHandleClick();
      updatePanelStats();
    };
  </script>
</body>
</html>
