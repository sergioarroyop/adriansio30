<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Alc√°ntara en apuros</title>
  <link rel="stylesheet" href="../assets/style.css">
</head>
<body>
  <div id="container">
    <div id="gameWrapper">
      <canvas id="game"></canvas>
    </div>
  </div>
  <div id="winModal" class="hidden">
    <div class="modal-content">
      <h1>¬°Cago en la leche Merche! Que casi llego tarde al cumplea√±os.</h1>
      <h3>¬°Enhorabuena! Antonio Alc√°ntara ha llegado a la fiesta gracias a tu ayuda.</h3>
    </div>
  </div>
  <script src="../assets/gameStorage.js"></script>
  <script src="../assets/sidePanel.js"></script>
  <script src="juego1.js"></script>
  <audio id="bgBirthday" src="../../sounds/birthday.mp3" loop></audio>
  <script>
    // ===== Panel Lateral para Juego 1 =====
    let gameStats = {
      score: 0,
      level: 1,
      status: 'üîÑ En Progreso'
    };

    let gameOptions = {
      immortal: false,
      sound: true,
    };

    // Crear panel lateral
    function initSidePanel() {
      if (window.SidePanel) {
        window.SidePanel.createSidePanel({
          gameName: 'Alc√°ntara en apuros',
          gameId: 'juego1',
          stats: gameStats,
          options: gameOptions,
          optionsTemplate: `
            <div class="panel-section">
              <h4>‚öôÔ∏è Opciones</h4>
              <div class="option-item">
                <span class="option-label">Modo Inmortal</span>
                <div class="toggle ${gameOptions.immortal ? 'active' : ''}" id="immortalToggle"></div>
              </div>
            </div>
            <button class="btn secondary" id="fullscreenBtn">‚õ∂ Pantalla completa</button>
          `,
          onBack: () => window.location.href = '../index.html',
          onRestart: () => {
            if (typeof resetGame === 'function') {
              resetGame();
            }
          },
          onOptionChange: (newOptions) => {
            gameOptions = { ...gameOptions, ...newOptions };
            if (window.GameStorage) {
              window.GameStorage.updateGameOptions(gameOptions);
            }
            
            // Aplicar modo inmortal directamente
            if (newOptions.immortal !== undefined) {
              window.IMMORTAL_MODE = newOptions.immortal;
              console.log(`Modo inmortal: ${newOptions.immortal ? 'ACTIVADO' : 'DESACTIVADO'}`);
            }
          }
        });
      }
    }

    // Actualizar estad√≠sticas del panel
    function updatePanelStats() {
      if (window.SidePanel) {
        gameStats.level = currentFloor || 1;
        gameStats.score = Math.floor((currentFloor || 1) * 100);
        window.SidePanel.updateSidePanelStats(gameStats);
      }
    }

    // Inicializar panel cuando se carga la p√°gina
    document.addEventListener('DOMContentLoaded', initSidePanel);

    // Audio de fondo de cumplea√±os al cargar
    (function(){
      const a = document.getElementById('bgBirthday');
      if (!a) return;
      a.volume = 0.6;
      a.play().catch(()=>{});
    })();

    // Actualizar estad√≠sticas cada frame - esperar a que game.js est√© cargado
    function setupUpdateOverride() {
      if (typeof update === 'function') {
        const originalUpdate = update;
        update = function() {
          originalUpdate();
          updatePanelStats();
        };
      } else {
        // Si update no est√° disponible a√∫n, reintentar en el siguiente frame
        requestAnimationFrame(setupUpdateOverride);
      }
    }
    
    // Configurar la sobrescritura de update despu√©s de que se cargue game.js
    setTimeout(setupUpdateOverride, 100);
  </script>
</body>
</html>
